global
  maxconn 50000
  log 127.0.0.1:514 local0 info
  user haproxy
  group haproxy
  stats socket {{ haproxy_sock }} user haproxy group haproxy mode 660 level admin
  ssl-default-bind-options no-sslv3 no-tlsv10 no-tlsv11 no-tls-tickets
  ssl-default-bind-ciphers EECDH+AESGCM:EDH+AESGCM
  tune.ssl.default-dh-param 2048

defaults
  timeout connect 10s
  timeout client 30s
  timeout server 30s
  log global
  mode http
  option httplog

listen proxy
  option forwardfor
  bind *:80
  bind *:443 ssl crt {{ haproxy_cert }} ciphers EECDH+AESGCM:EDH+AESGCM no-sslv3 no-tlsv10 no-tlsv11
  bind *:8088
  balance roundrobin
  default-server maxconn 1000
  http-request set-header X-Forwarded-Port %[dst_port]
  http-request set-header X-Forwarded-Scheme http unless { ssl_fc }
{% for name in server_names %}
  server {{ name }} unix@{{ server_dir }}/{{ name }}.sock
{% endfor %}

listen stats
  bind :9000
  mode http
  stats enable
  stats uri /
  stats refresh 2s
  stats admin if LOCALHOST
